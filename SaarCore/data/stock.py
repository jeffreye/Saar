from datetime import datetime,timedelta
from threading import Semaphore,local
from data.sql import *
from enum import IntEnum


class stock_state(IntEnum):
    wait = 0

    open_position = 1
    '''bought just now'''

    hold_position = 2

    sell_half = 1

    close_position = 0


network_pool = Semaphore(value = 1)
local_file_pool = Semaphore(value = 1)
historical_price_directory = 'hist'
csv_ext = '.csv'
google_historical_price_page = 'http://www.google.com/finance/historical?q={0}&startdate={1}&enddate={2}&num=200&start={3}';

def get_csv_path(symbol):
    from os.path import join
    return join(historical_price_directory,symbol.replace(':','-')+csv_ext)
   

def convert_to_yahoo_symbol(sym):
    if sym.startswith('SHA:'):
        return sym[4:] + '.SS'
    elif sym.startswith('SHE:'):
        return sym[4:] + '.SZ'
    elif sym.startswith('MUTF_CN:'):
        return sym[8:] + '.SS'

def retrieve_stock(symbol,from_date,to_date):
    '''retrieve stock's prices'''
    import pandas   
    from pandas.io.data import DataReader
    from math import ceil
    from os.path import isfile

    #try read it from local file
    csv_path = get_csv_path(symbol)
    if isfile(csv_path):
        with local_file_pool:
            data = pandas.read_csv(csv_path)
            if not data.empty:
                if data.columns[0] != 'Date':
                    data.rename(columns ={data.columns[0]:'Date'},inplace = True)
                data.set_index('Date',inplace = True)
                data.index = pandas.to_datetime(data.index)
                return data[data.Volume != 0]

    #Fetch from yahoo finance or google finance
    with network_pool:
        try:
            prices = DataReader(convert_to_yahoo_symbol(symbol),'yahoo',start = from_date,end = to_date)
        except:
            # Cannot fetch from yahoo finance
            prices = pandas.DataFrame()
            for page in range(0,ceil((to_date-from_date).days / 200)):
                url = google_historical_price_page.format(symbol.replace(':','%3A'),from_date.strftime('%b+%d%%2C+%Y'),to_date.strftime('%b+%d%%2C+%Y'),page * 200)
                raw = pandas.read_html(url)
                if len(raw) <= 2:
                    break
                else:
                    data = raw[-1]
                    if len(data.keys()) >= 6:
                        data.rename(columns = { 0:'Date',1:'Open' ,2: 'High', 3:  'Low',4:  'Close',5:'Volume'},inplace = True)
                    else:
                        data.rename(columns = { 0:'Date',1:'Close'},inplace = True)
                    data = data[data.Volume != '-']
                    data.set_index('Date',inplace = True)
                    data = data.ix[1:]
                    data.index = pandas.to_datetime(data.index)
                    prices = prices.append(data.astype('float'))
                    
        #save to local
        
        prices = prices[prices.Volume != 0]
        prices.to_csv(csv_path,index_label = 'Date')
        return prices
class stock(Model):
    """base model of stock"""
    __tablename__ = 'stock'

    code = Column(String(10),primary_key = True)
    name = Column(String(250),nullable = True)

    def __init__(self,code = '000001',name = 'unknown'):
        import pandas   
        self.code =code
        ''' stock's code '''

        self.name = name
        '''stock's name'''

        self.prices = pandas.DataFrame()
        '''storing prices'''
        
        self.thread_local = local()
        
    @reconstructor
    def init_on_load(self):    
        import pandas   
        self.prices = pandas.DataFrame()
        '''storing prices'''
        
        self.thread_local = local()

    def to_dict(self):
        return {
                    'Code':self.code,
                    'Name':self.name,
                }

    def __repr__(self):
        return '<stock code=%s name=%s>' % (self.code,self.name)
        

    def pull_data(self,from_date,to_date):
        if not self.prices.empty and from_date >= self.from_date and to_date <= self.to_date:
            return True

        try:
            self.prices = retrieve_stock(self.code,from_date,to_date)
        except:            
            import sys
            print("Unexpected error ( %s ) when retrieving stocks:%s" % (str(sys.exc_info()[1]),self.code))
            return False
        else:
            self.prices.sort(inplace = True)
            self.from_date = self.prices.index.min()
            self.to_date = self.prices.index.max()
            return True

    @property
    def indicator_values(self):        
        '''storing indicator values temporarily'''
        if not hasattr(self.thread_local,'_indicator_values'):
            self.thread_local._indicator_values = {}
        return self.thread_local._indicator_values



all_stock_json_link = 'http://www.google.com.hk/finance?start=0&num=4000&q=%5B((exchange%20%3D%3D%20"SHE")%20%7C%20(exchange%20%3D%3D%20"SHA"))%5D&restype=company&output=json&gl=cn'

def retrieve_stock_list():
    '''get all tickers from market'''
    
    china_stocks.clear()
    from urllib.request import urlopen
    import json
    raw = urlopen(all_stock_json_link).readall().decode('utf-8')
    valid_json = raw.replace('\n"original_query" : "[((exchange == \\x22SHE\\x22) | (exchange == \\x22SHA\\x22))]",\n"query_for_display" : "[((exchange == &quot;SHE&quot;) | (exchange == &quot;SHA&quot;))]",','').replace('\\x26','&')
    
    j = json.loads(valid_json)
    for r in j['searchresults']:
        china_stocks.append( stock('%s:%s' % (r['exchange'],r['ticker']),r['title']) )
    
def all_stocks():
    if len(china_stocks) == 0:
        retrieve_stock_list()
    return china_stocks
        

china_stocks = []

'''SHA SHE MUTF_CN '''

shenzheng_stocks_codes = ['500038', '500056', '500058', '505888', '510010', '510011', '510012', '510020', '510021', '510022', '510030', '510031', '510032', '510050', '510051', '510052', '510060', '510061', '510062', '510070', '510071', '510072', '510090', '510091', '510092', '510110', '510111', '510112', '510120', '510121', '510122', '510130', '510131', '510132', '510150', '510151', '510152', '510160', '510161', '510162', '510170', '510171', '510172', '510180', '510181', '510182', '510190', '510191', '510192', '510210', '510211', '510212', '510220', '510221', '510222', '510230', '510231', '510232', '510260', '510261', '510262', '510270', '510271', '510272', '510280', '510281', '510282', '510290', '510291', '510292', '510300', '510301', '510302', '510305', '510310', '510311', '510312', '510315', '510330', '510331', '510332', '510335', '510410', '510411', '510412', '510420', '510421', '510422', '510430', '510431', '510432', '510440', '510441', '510442', '510450', '510451', '510452', '510500', '510501', '510502', '510505', '510510', '510511', '510512', '510515', '510520', '510521', '510522', '510525', '510610', '510611', '510612', '510620', '510621', '510622', '510630', '510631', '510632', '510650', '510651', '510652', '510660', '510661', '510662', '510680', '510681', '510682', '510700', '510701', '510702', '510880', '510881', '510882', '510900', '510901', '510902', '510905', '511010', '511011', '511012', '511210', '511211', '511212', '511220', '511221', '511222', '511800', '511801', '511802', '511805', '511810', '511811', '511812', '511815', '511860', '511861', '511862', '511865', '511880', '511881', '511882', '511885', '511990', '511991', '511992', '511995', '512010', '512011', '512012', '512015', '512070', '512071', '512072', '512075', '512110', '512111', '512112', '512115', '512120', '512121', '512122', '512125', '512210', '512211', '512212', '512215', '512220', '512221', '512222', '512225', '512230', '512231', '512232', '512235', '512300', '512301', '512302', '512305', '512313', '512314', '512343', '512344', '512600', '512601', '512602', '512605', '512610', '512611', '512612', '512615', '512640', '512641', '512642', '512645', '512990', '512991', '512992', '512995', '513030', '513031', '513032', '513035', '513100', '513101', '513102', '513105', '513500', '513501', '513502', '513505', '513600', '513601', '513602', '513605', '513660', '513661', '513662', '513665', '518800', '518801', '518802', '518805', '518880', '518881', '518882', '518885', '519001', '519002', '519003', '519005', '519007', '519008', '519011', '519013', '519015', '519017', '519018', '519019', '519020', '519021', '519023', '519025', '519026', '519027', '519028', '519029', '519030', '519032', '519033', '519034', '519035', '519039', '519050', '519056', '519060', '519061', '519062', '519066', '519068', '519069', '519078', '519087', '519089', '519093', '519095', '519097', '519099', '519100', '519110', '519111', '519112', '519113', '519115', '519116', '519117', '519118', '519119', '519120', '519121', '519122', '519123', '519124', '519125', '519126', '519127', '519128', '519129', '519130', '519150', '519152', '519153', '519156', '519158', '519160', '519161', '519162', '519163', '519165', '519167', '519170', '519180', '519181', '519183', '519185', '519186', '519188', '519189', '519190', '519191', '519192', '519300', '519505', '519506', '519507', '519508', '519509', '519510', '519511', '519512', '519513', '519518', '519519', '519528', '519529', '519566', '519567', '519598', '519599', '519606', '519654', '519655', '519656', '519657', '519660', '519661', '519662', '519663', '519664', '519665', '519666', '519668', '519669', '519670', '519671', '519672', '519673', '519674', '519675', '519676', '519677', '519678', '519679', '519680', '519683', '519688', '519690', '519692', '519698', '519700', '519702', '519704', '519706', '519712', '519714', '519718', '519723', '519727', '519733', '519734', '519735', '519800', '519801', '519808', '519809', '519858', '519859', '519878', '519879', '519888', '519889', '519898', '519899', '519908', '519909', '519915', '519918', '519969', '519971', '519972', '519973', '519975', '519976', '519977', '519979', '519983', '519985', '519987', '519989', '519991', '519993', '519995', '519997', '521654', '521655', '522001', '522002', '522003', '522005', '522007', '522008', '522011', '522013', '522015', '522017', '522018', '522019', '522020', '522021', '522023', '522025', '522026', '522027', '522028', '522029', '522030', '522032', '522033', '522034', '522035', '522039', '522050', '522056', '522060', '522061', '522062', '522066', '522068', '522069', '522078', '522087', '522089', '522093', '522095', '522097', '522099', '522100', '522110', '522111', '522112', '522113', '522115', '522116', '522117', '522118', '522119', '522120', '522121', '522122', '522123', '522124', '522125', '522126', '522127', '522130', '522150', '522152', '522153', '522156', '522158', '522160', '522161', '522162', '522163', '522167', '522180', '522181', '522183', '522185', '522186', '522188', '522189', '522190', '522191', '522300', '522505', '522506', '522507', '522508', '522509', '522510', '522511', '522512', '522513', '522518', '522519', '522528', '522529', '522566', '522567', '522598', '522599', '522606', '522656', '522657', '522660', '522661', '522662', '522663', '522664', '522665', '522666', '522668', '522669', '522670', '522671', '522672', '522673', '522674', '522675', '522676', '522677', '522678', '522679', '522680', '522683', '522688', '522690', '522692', '522698', '522700', '522702', '522704', '522706', '522712', '522714', '522718', '522723', '522727', '522733', '522908', '522909', '522915', '522918', '522969', '522971', '522972', '522973', '522975', '522976', '522977', '522979', '522983', '522985', '522987', '522989', '522991', '522993', '522995', '522997', '523001', '523002', '523003', '523005', '523007', '523008', '523011', '523013', '523015', '523017', '523018', '523019', '523020', '523021', '523023', '523025', '523026', '523027', '523028', '523029', '523030', '523032', '523033', '523034', '523035', '523039', '523050', '523056', '523060', '523061', '523062', '523066', '523068', '523069', '523078', '523087', '523089', '523093', '523095', '523097', '523099', '523100', '523110', '523111', '523112', '523113', '523115', '523116', '523117', '523118', '523120', '523121', '523123', '523124', '523125', '523126', '523127', '523130', '523150', '523152', '523153', '523156', '523158', '523160', '523161', '523162', '523163', '523167', '523180', '523181', '523183', '523185', '523186', '523188', '523189', '523190', '523191', '523300', '523519', '523606', '523656', '523657', '523660', '523661', '523662', '523663', '523664', '523665', '523666', '523668', '523669', '523670', '523671', '523672', '523673', '523674', '523675', '523676', '523677', '523678', '523679', '523680', '523683', '523688', '523690', '523692', '523698', '523700', '523702', '523704', '523706', '523712', '523714', '523718', '523723', '523727', '523733', '523908', '523909', '523915', '523918', '523969', '523971', '523972', '523973', '523975', '523976', '523977', '523979', '523983', '523985', '523987', '523989', '523991', '523993', '523995', '523997', '600000', '600004', '600005', '600006', '600007', '600008', '600009', '600010', '600011', '600012', '600015', '600016', '600017', '600018', '600019', '600020', '600021', '600022', '600023', '600026', '600027', '600028', '600029', '600030', '600031', '600033', '600035', '600036', '600037', '600038', '600039', '600048', '600050', '600051', '600052', '600053', '600054', '600055', '600056', '600057', '600058', '600059', '600060', '600061', '600062', '600063', '600064', '600066', '600067', '600068', '600069', '600070', '600071', '600072', '600073', '600074', '600075', '600076', '600077', '600078', '600079', '600080', '600081', '600082', '600083', '600084', '600085', '600086', '600088', '600089', '600090', '600091', '600093', '600094', '600095', '600096', '600097', '600098', '600099', '600100', '600101', '600103', '600104', '600105', '600106', '600107', '600108', '600109', '600110', '600111', '600112', '600113', '600114', '600115', '600116', '600117', '600118', '600119', '600120', '600121', '600122', '600123', '600125', '600126', '600127', '600128', '600129', '600130', '600131', '600132', '600133', '600135', '600136', '600137', '600138', '600139', '600141', '600143', '600145', '600146', '600148', '600149', '600150', '600151', '600152', '600153', '600155', '600156', '600157', '600158', '600159', '600160', '600161', '600162', '600163', '600165', '600166', '600167', '600168', '600169', '600170', '600171', '600172', '600173', '600175', '600176', '600177', '600178', '600179', '600180', '600182', '600183', '600184', '600185', '600186', '600187', '600188', '600189', '600190', '600191', '600192', '600193', '600195', '600196', '600197', '600198', '600199', '600200', '600201', '600202', '600203', '600206', '600207', '600208', '600209', '600210', '600211', '600212', '600213', '600215', '600216', '600217', '600218', '600219', '600220', '600221', '600222', '600223', '600225', '600226', '600227', '600228', '600229', '600230', '600231', '600232', '600233', '600234', '600235', '600236', '600237', '600238', '600239', '600240', '600241', '600242', '600243', '600246', '600247', '600248', '600249', '600250', '600251', '600252', '600255', '600256', '600257', '600258', '600259', '600260', '600261', '600262', '600265', '600266', '600267', '600268', '600269', '600270', '600271', '600272', '600273', '600275', '600276', '600277', '600278', '600279', '600280', '600281', '600282', '600283', '600284', '600285', '600287', '600288', '600289', '600290', '600291', '600292', '600293', '600295', '600297', '600298', '600299', '600300', '600301', '600302', '600303', '600305', '600306', '600307', '600308', '600309', '600310', '600311', '600312', '600313', '600315', '600316', '600317', '600318', '600319', '600320', '600321', '600322', '600323', '600325', '600326', '600327', '600328', '600329', '600330', '600331', '600332', '600333', '600335', '600336', '600337', '600338', '600339', '600340', '600343', '600345', '600346', '600348', '600350', '600351', '600352', '600353', '600354', '600355', '600356', '600358', '600359', '600360', '600361', '600362', '600363', '600365', '600366', '600367', '600368', '600369', '600370', '600371', '600372', '600373', '600375', '600376', '600377', '600378', '600379', '600380', '600381', '600382', '600383', '600385', '600386', '600387', '600388', '600389', '600390', '600391', '600392', '600393', '600395', '600396', '600397', '600398', '600399', '600400', '600401', '600403', '600405', '600406', '600408', '600409', '600410', '600415', '600416', '600418', '600419', '600420', '600421', '600422', '600423', '600425', '600426', '600428', '600429', '600432', '600433', '600435', '600436', '600438', '600439', '600444', '600446', '600448', '600449', '600452', '600455', '600456', '600458', '600459', '600460', '600461', '600462', '600463', '600466', '600467', '600468', '600469', '600470', '600475', '600476', '600477', '600478', '600479', '600480', '600481', '600482', '600483', '600485', '600486', '600487', '600488', '600489', '600490', '600491', '600493', '600495', '600496', '600497', '600498', '600499', '600500', '600501', '600502', '600503', '600505', '600506', '600507', '600508', '600509', '600510', '600511', '600512', '600513', '600515', '600516', '600517', '600518', '600519', '600520', '600521', '600522', '600523', '600525', '600526', '600527', '600528', '600529', '600530', '600531', '600532', '600533', '600535', '600536', '600537', '600538', '600539', '600540', '600543', '600545', '600546', '600547', '600548', '600549', '600550', '600551', '600552', '600555', '600556', '600557', '600558', '600559', '600560', '600561', '600562', '600563', '600565', '600566', '600567', '600568', '600569', '600570', '600571', '600572', '600573', '600575', '600576', '600577', '600578', '600579', '600580', '600581', '600582', '600583', '600584', '600585', '600586', '600587', '600588', '600589', '600590', '600592', '600593', '600594', '600595', '600596', '600597', '600598', '600599', '600600', '600601', '600602', '600603', '600604', '600605', '600606', '600608', '600609', '600610', '600611', '600612', '600613', '600614', '600615', '600616', '600617', '600618', '600619', '600620', '600621', '600622', '600623', '600624', '600626', '600628', '600629', '600630', '600633', '600634', '600635', '600636', '600637', '600638', '600639', '600640', '600641', '600642', '600643', '600644', '600645', '600647', '600648', '600649', '600650', '600651', '600652', '600653', '600654', '600655', '600656', '600657', '600658', '600660', '600661', '600662', '600663', '600664', '600665', '600666', '600667', '600668', '600671', '600673', '600674', '600675', '600676', '600677', '600678', '600679', '600680', '600681', '600682', '600683', '600684', '600685', '600686', '600687', '600688', '600689', '600690', '600691', '600692', '600693', '600694', '600695', '600696', '600697', '600698', '600699', '600701', '600702', '600703', '600704', '600705', '600706', '600707', '600708', '600710', '600711', '600712', '600713', '600714', '600715', '600716', '600717', '600718', '600719', '600720', '600721', '600722', '600723', '600724', '600725', '600726', '600727', '600728', '600729', '600730', '600731', '600732', '600733', '600734', '600735', '600736', '600737', '600738', '600739', '600740', '600741', '600742', '600743', '600744', '600745', '600746', '600747', '600748', '600749', '600750', '600751', '600753', '600754', '600755', '600756', '600757', '600758', '600759', '600760', '600761', '600763', '600764', '600765', '600766', '600767', '600768', '600769', '600770', '600771', '600773', '600774', '600775', '600776', '600777', '600778', '600779', '600780', '600781', '600782', '600783', '600784', '600785', '600787', '600789', '600790', '600791', '600792', '600793', '600794', '600795', '600796', '600797', '600798', '600800', '600801', '600802', '600803', '600804', '600805', '600806', '600807', '600808', '600809', '600810', '600811', '600812', '600814', '600815', '600816', '600817', '600818', '600819', '600820', '600821', '600822', '600823', '600824', '600825', '600826', '600827', '600828', '600829', '600830', '600831', '600832', '600833', '600834', '600835', '600836', '600837', '600838', '600839', '600841', '600843', '600844', '600845', '600846', '600847', '600848', '600850', '600851', '600853', '600854', '600855', '600856', '600857', '600858', '600859', '600860', '600861', '600862', '600863', '600864', '600865', '600866', '600867', '600868', '600869', '600870', '600871', '600872', '600873', '600874', '600875', '600876', '600877', '600879', '600880', '600881', '600882', '600883', '600884', '600885', '600886', '600887', '600888', '600889', '600890', '600891', '600892', '600893', '600894', '600895', '600896', '600897', '600898', '600900', '600917', '600958', '600959', '600960', '600961', '600962', '600963', '600965', '600966', '600967', '600969', '600970', '600971', '600973', '600975', '600976', '600978', '600979', '600980', '600981', '600982', '600983', '600984', '600985', '600986', '600987', '600988', '600990', '600992', '600993', '600995', '600997', '600998', '600999', '601000', '601001', '601002', '601003', '601005', '601006', '601007', '601008', '601009', '601010', '601011', '601012', '601015', '601016', '601018', '601021', '601028', '601038', '601058', '601069', '601088', '601098', '601099', '601100', '601101', '601106', '601107', '601111', '601113', '601116', '601117', '601118', '601126', '601137', '601139', '601158', '601166', '601168', '601169', '601177', '601179', '601186', '601188', '601198', '601199', '601208', '601216', '601218', '601222', '601225', '601226', '601231', '601233', '601238', '601258', '601268', '601288', '601299', '601311', '601313', '601318', '601328', '601333', '601336', '601339', '601369', '601377', '601388', '601390', '601398', '601515', '601518', '601519', '601555', '601558', '601566', '601567', '601579', '601588', '601599', '601600', '601601', '601607', '601608', '601616', '601618', '601628', '601633', '601636', '601666', '601668', '601669', '601677', '601678', '601688', '601689', '601699', '601700', '601717', '601718', '601727', '601766', '601777', '601788', '601789', '601798', '601799', '601800', '601801', '601808', '601818', '601857', '601866', '601872', '601877', '601880', '601886', '601888', '601890', '601898', '601899', '601901', '601908', '601918', '601919', '601928', '601929', '601933', '601939', '601958', '601965', '601969', '601988', '601989', '601991', '601992', '601996', '601998', '601999', '603000', '603001', '603002', '603003', '603005', '603006', '603008', '603009', '603010', '603011', '603012', '603015', '603017', '603018', '603019', '603020', '603021', '603025', '603030', '603077', '603088', '603099', '603100', '603111', '603118', '603123', '603126', '603128', '603158', '603166', '603167', '603168', '603169', '603188', '603199', '603222', '603268', '603288', '603306', '603308', '603309', '603315', '603318', '603328', '603333', '603338', '603366', '603368', '603369', '603399', '603456', '603518', '603519', '603555', '603558', '603567', '603588', '603600', '603601', '603606', '603609', '603611', '603618', '603636', '603678', '603686', '603688', '603698', '603699', '603703', '603729', '603766', '603788', '603789', '603799', '603806', '603808', '603818', '603828', '603869', '603883', '603889', '603898', '603899', '603939', '603969', '603988', '603993', '603997', '603998']
'''Cached SHA stocks' codes'''

shanghai_stocks_codes = ['000001', '000002', '000004', '000005', '000006', '000007', '000008', '000009', '000010', '000011', '000012', '000014', '000016', '000017', '000018', '000019', '000020', '000021', '000022', '000023', '000024', '000025', '000026', '000027', '000028', '000029', '000030', '000031', '000032', '000033', '000034', '000035', '000036', '000037', '000038', '000039', '000040', '000042', '000043', '000045', '000046', '000048', '000049', '000050', '000055', '000056', '000058', '000059', '000060', '000061', '000062', '000063', '000065', '000066', '000068', '000069', '000070', '000078', '000088', '000089', '000090', '000096', '000099', '000100', '000150', '000151', '000153', '000155', '000156', '000157', '000158', '000159', '000166', '000301', '000333', '000338', '000400', '000401', '000402', '000403', '000404', '000407', '000408', '000409', '000410', '000411', '000413', '000415', '000416', '000417', '000418', '000419', '000420', '000421', '000422', '000423', '000425', '000426', '000428', '000429', '000430', '000488', '000498', '000501', '000502', '000503', '000504', '000505', '000506', '000507', '000509', '000510', '000511', '000513', '000514', '000516', '000517', '000518', '000519', '000520', '000521', '000523', '000524', '000525', '000526', '000528', '000529', '000530', '000531', '000532', '000533', '000534', '000536', '000537', '000538', '000539', '000540', '000541', '000543', '000544', '000545', '000546', '000547', '000548', '000550', '000551', '000552', '000553', '000554', '000555', '000557', '000558', '000559', '000560', '000561', '000563', '000564', '000565', '000566', '000567', '000568', '000570', '000571', '000572', '000573', '000576', '000581', '000582', '000584', '000585', '000586', '000587', '000589', '000590', '000591', '000592', '000593', '000594', '000595', '000596', '000597', '000598', '000599', '000600', '000601', '000603', '000605', '000606', '000607', '000608', '000609', '000610', '000611', '000612', '000613', '000615', '000616', '000617', '000619', '000620', '000622', '000623', '000625', '000626', '000627', '000628', '000629', '000630', '000631', '000632', '000633', '000635', '000636', '000637', '000638', '000639', '000650', '000651', '000652', '000655', '000656', '000657', '000659', '000661', '000662', '000663', '000665', '000666', '000667', '000668', '000669', '000670', '000671', '000672', '000673', '000676', '000677', '000678', '000679', '000680', '000681', '000682', '000683', '000685', '000686', '000687', '000688', '000690', '000691', '000692', '000693', '000695', '000697', '000698', '000700', '000701', '000702', '000703', '000705', '000707', '000708', '000709', '000710', '000711', '000712', '000713', '000715', '000716', '000717', '000718', '000719', '000720', '000721', '000722', '000723', '000725', '000726', '000727', '000728', '000729', '000731', '000732', '000733', '000735', '000736', '000737', '000738', '000739', '000748', '000750', '000751', '000752', '000753', '000755', '000756', '000757', '000758', '000759', '000760', '000761', '000762', '000766', '000767', '000768', '000776', '000777', '000778', '000779', '000780', '000782', '000783', '000785', '000786', '000788', '000789', '000790', '000791', '000792', '000793', '000795', '000796', '000797', '000798', '000799', '000800', '000801', '000802', '000803', '000806', '000807', '000809', '000810', '000811', '000812', '000813', '000815', '000816', '000818', '000819', '000820', '000821', '000822', '000823', '000825', '000826', '000828', '000829', '000830', '000831', '000833', '000835', '000836', '000837', '000838', '000839', '000848', '000850', '000851', '000852', '000856', '000858', '000859', '000860', '000861', '000862', '000863', '000868', '000869', '000875', '000876', '000877', '000878', '000880', '000881', '000882', '000883', '000885', '000886', '000887', '000888', '000889', '000890', '000892', '000893', '000895', '000897', '000898', '000899', '000900', '000901', '000902', '000903', '000905', '000906', '000908', '000909', '000910', '000911', '000912', '000913', '000915', '000916', '000917', '000918', '000919', '000920', '000921', '000922', '000923', '000925', '000926', '000927', '000928', '000929', '000930', '000931', '000932', '000933', '000935', '000936', '000937', '000938', '000939', '000948', '000949', '000950', '000951', '000952', '000953', '000955', '000957', '000958', '000959', '000960', '000961', '000962', '000963', '000965', '000966', '000967', '000968', '000969', '000970', '000971', '000972', '000973', '000975', '000976', '000977', '000978', '000979', '000980', '000981', '000982', '000983', '000985', '000987', '000988', '000989', '000990', '000993', '000995', '000996', '000997', '000998', '000999', '001696', '001896', '002001', '002002', '002003', '002004', '002005', '002006', '002007', '002008', '002009', '002010', '002011', '002012', '002013', '002014', '002015', '002016', '002017', '002018', '002019', '002020', '002021', '002022', '002023', '002024', '002025', '002026', '002027', '002028', '002029', '002030', '002031', '002032', '002033', '002034', '002035', '002036', '002037', '002038', '002039', '002040', '002041', '002042', '002043', '002044', '002045', '002046', '002047', '002048', '002049', '002050', '002051', '002052', '002053', '002054', '002055', '002056', '002057', '002058', '002059', '002060', '002061', '002062', '002063', '002064', '002065', '002066', '002067', '002068', '002069', '002070', '002071', '002072', '002073', '002074', '002075', '002076', '002077', '002078', '002079', '002080', '002081', '002082', '002083', '002084', '002085', '002086', '002087', '002088', '002089', '002090', '002091', '002092', '002093', '002094', '002095', '002096', '002097', '002098', '002099', '002100', '002101', '002102', '002103', '002104', '002105', '002106', '002107', '002108', '002109', '002110', '002111', '002112', '002113', '002114', '002115', '002116', '002117', '002118', '002119', '002120', '002121', '002122', '002123', '002124', '002125', '002126', '002127', '002128', '002129', '002130', '002131', '002132', '002133', '002134', '002135', '002136', '002137', '002138', '002139', '002140', '002141', '002142', '002143', '002144', '002145', '002146', '002147', '002148', '002149', '002150', '002151', '002152', '002153', '002154', '002155', '002156', '002157', '002158', '002159', '002160', '002161', '002162', '002163', '002164', '002165', '002166', '002167', '002168', '002169', '002170', '002171', '002172', '002173', '002174', '002175', '002176', '002177', '002178', '002179', '002180', '002181', '002182', '002183', '002184', '002185', '002186', '002187', '002188', '002189', '002190', '002191', '002192', '002193', '002194', '002195', '002196', '002197', '002198', '002199', '002200', '002201', '002202', '002203', '002204', '002205', '002206', '002207', '002208', '002209', '002210', '002211', '002212', '002213', '002214', '002215', '002216', '002217', '002218', '002219', '002220', '002221', '002222', '002223', '002224', '002225', '002226', '002227', '002228', '002229', '002230', '002231', '002232', '002233', '002234', '002235', '002236', '002237', '002238', '002239', '002240', '002241', '002242', '002243', '002244', '002245', '002246', '002247', '002248', '002249', '002250', '002251', '002252', '002253', '002254', '002255', '002256', '002258', '002259', '002260', '002261', '002262', '002263', '002264', '002265', '002266', '002267', '002268', '002269', '002270', '002271', '002272', '002273', '002274', '002275', '002276', '002277', '002278', '002279', '002280', '002281', '002282', '002283', '002284', '002285', '002286', '002287', '002288', '002289', '002290', '002291', '002292', '002293', '002294', '002295', '002296', '002297', '002298', '002299', '002300', '002301', '002302', '002303', '002304', '002305', '002306', '002307', '002308', '002309', '002310', '002311', '002312', '002313', '002314', '002315', '002316', '002317', '002318', '002319', '002320', '002321', '002322', '002323', '002324', '002325', '002326', '002327', '002328', '002329', '002330', '002331', '002332', '002333', '002334', '002335', '002336', '002337', '002338', '002339', '002340', '002341', '002342', '002343', '002344', '002345', '002346', '002347', '002348', '002349', '002350', '002351', '002352', '002353', '002354', '002355', '002356', '002357', '002358', '002359', '002360', '002361', '002362', '002363', '002364', '002365', '002366', '002367', '002368', '002369', '002370', '002371', '002372', '002373', '002374', '002375', '002376', '002377', '002378', '002379', '002380', '002381', '002382', '002383', '002384', '002385', '002386', '002387', '002388', '002389', '002390', '002391', '002392', '002393', '002394', '002395', '002396', '002397', '002398', '002399', '002400', '002401', '002402', '002403', '002404', '002405', '002406', '002407', '002408', '002409', '002410', '002411', '002412', '002413', '002414', '002415', '002416', '002417', '002418', '002419', '002420', '002421', '002422', '002423', '002424', '002425', '002426', '002427', '002428', '002429', '002430', '002431', '002432', '002433', '002434', '002435', '002436', '002437', '002438', '002439', '002440', '002441', '002442', '002443', '002444', '002445', '002446', '002447', '002448', '002449', '002450', '002451', '002452', '002453', '002454', '002455', '002456', '002457', '002458', '002459', '002460', '002461', '002462', '002463', '002464', '002465', '002466', '002467', '002468', '002469', '002470', '002471', '002472', '002473', '002474', '002475', '002476', '002477', '002478', '002479', '002480', '002481', '002482', '002483', '002484', '002485', '002486', '002487', '002488', '002489', '002490', '002491', '002492', '002493', '002494', '002495', '002496', '002497', '002498', '002499', '002500', '002501', '002502', '002503', '002504', '002505', '002506', '002507', '002508', '002509', '002510', '002511', '002512', '002513', '002514', '002515', '002516', '002517', '002518', '002519', '002520', '002521', '002522', '002523', '002524', '002526', '002527', '002528', '002529', '002530', '002531', '002532', '002533', '002534', '002535', '002536', '002537', '002538', '002539', '002540', '002541', '002542', '002543', '002544', '002545', '002546', '002547', '002548', '002549', '002550', '002551', '002552', '002553', '002554', '002555', '002556', '002557', '002558', '002559', '002560', '002561', '002562', '002563', '002564', '002565', '002566', '002567', '002568', '002569', '002570', '002571', '002572', '002573', '002574', '002575', '002576', '002577', '002578', '002579', '002580', '002581', '002582', '002583', '002584', '002585', '002586', '002587', '002588', '002589', '002590', '002591', '002592', '002593', '002594', '002595', '002596', '002597', '002598', '002599', '002600', '002601', '002602', '002603', '002604', '002605', '002606', '002607', '002608', '002609', '002610', '002611', '002612', '002613', '002614', '002615', '002616', '002617', '002618', '002619', '002620', '002621', '002622', '002623', '002624', '002625', '002626', '002627', '002628', '002629', '002630', '002631', '002632', '002633', '002634', '002635', '002636', '002637', '002638', '002639', '002640', '002641', '002642', '002643', '002644', '002645', '002646', '002647', '002648', '002649', '002650', '002651', '002652', '002653', '002654', '002655', '002656', '002657', '002658', '002659', '002660', '002661', '002662', '002663', '002664', '002665', '002666', '002667', '002668', '002669', '002670', '002671', '002672', '002673', '002674', '002675', '002676', '002677', '002678', '002679', '002680', '002681', '002682', '002683', '002684', '002685', '002686', '002687', '002688', '002689', '002690', '002691', '002692', '002693', '002694', '002695', '002696', '002697', '002698', '002699', '002700', '002701', '002702', '002703', '002705', '002706', '002707', '002708', '002709', '002711', '002712', '002713', '002714', '002715', '002716', '002717', '002718', '002719', '002721', '002722', '002723', '002724', '002725', '002726', '002727', '002728', '002729', '002730', '002731', '002732', '002733', '002734', '002735', '002736', '002737', '002738', '002739', '002740', '002741', '002742', '002743', '002745', '002746', '002747', '002748', '002749', '002750', '002751', '002752', '150001', '150008', '150009', '150012', '150013', '150016', '150017', '150018', '150019', '150020', '150021', '150022', '150023', '150027', '150028', '150029', '150030', '150031', '150032', '150033', '150034', '150035', '150036', '150037', '150039', '150040', '150042', '150047', '150048', '150049', '150050', '150051', '150052', '150053', '150054', '150055', '150056', '150057', '150058', '150059', '150060', '150064', '150065', '150066', '150067', '150073', '150075', '150076', '150077', '150080', '150081', '150082', '150083', '150084', '150085', '150086', '150087', '150088', '150089', '150090', '150091', '150092', '150093', '150094', '150095', '150096', '150097', '150098', '150099', '150100', '150101', '150102', '150104', '150105', '150106', '150107', '150108', '150109', '150110', '150111', '150112', '150113', '150114', '150117', '150118', '150120', '150121', '150122', '150123', '150124', '150128', '150129', '150130', '150131', '150132', '150133', '150134', '150137', '150138', '150139', '150140', '150141', '150142', '150143', '150144', '150145', '150146', '150147', '150148', '150149', '150150', '150151', '150152', '150153', '150154', '150156', '150157', '150158', '150160', '150161', '150164', '150165', '150167', '150168', '150169', '150170', '150171', '150172', '150173', '150174', '150175', '150176', '150177', '150178', '150179', '150180', '150181', '150182', '150184', '150185', '150186', '150187', '150188', '150189', '150190', '150191', '150192', '150193', '150194', '150195', '150198', '150199', '150200', '150201', '150203', '150204', '150205', '150206', '150207', '150208', '150209', '150210', '150213', '150214', '150217', '150218', '159001', '159003', '159005', '159900', '159901', '159902', '159903', '159905', '159906', '159907', '159908', '159909', '159910', '159911', '159912', '159913', '159915', '159916', '159917', '159918', '159919', '159920', '159921', '159922', '159923', '159924', '159925', '159926', '159927', '159928', '159929', '159930', '159931', '159932', '159933', '159934', '159935', '159936', '159937', '159938', '159939', '160105', '160106', '160119', '160123', '160125', '160127', '160128', '160130', '160131', '160133', '160211', '160212', '160215', '160216', '160217', '160218', '160219', '160220', '160222', '160311', '160314', '160415', '160416', '160417', '160505', '160512', '160513', '160515', '160603', '160605', '160607', '160610', '160611', '160613', '160615', '160616', '160617', '160618', '160620', '160621', '160624', '160625', '160626', '160627', '160628', '160629', '160630', '160631', '160706', '160716', '160717', '160718', '160719', '160720', '160805', '160806', '160807', '160808', '160809', '160810', '160812', '160813', '160910', '160915', '160916', '160918', '160919', '161005', '161010', '161014', '161015', '161017', '161019', '161022', '161024', '161025', '161026', '161115', '161116', '161117', '161118', '161119', '161207', '161210', '161213', '161216', '161217', '161219', '161223', '161505', '161507', '161607', '161610', '161614', '161706', '161713', '161714', '161715', '161716', '161718', '161719', '161720', '161721', '161810', '161811', '161812', '161813', '161815', '161816', '161818', '161819', '161820', '161821', '161825', '161826', '161831', '161903', '161907', '161908', '161910', '161911', '162006', '162010', '162105', '162107', '162207', '162216', '162307', '162308', '162411', '162509', '162510', '162605', '162607', '162703', '162711', '162712', '162714', '162715', '162907', '163001', '163109', '163110', '163111', '163112', '163113', '163114', '163115', '163208', '163209', '163210', '163302', '163402', '163406', '163407', '163409', '163412', '163415', '163503', '163801', '163803', '163804', '163805', '163806', '163807', '163808', '163809', '163810', '163819', '163821', '163824', '163827', '164105', '164205', '164208', '164304', '164401', '164606', '164701', '164702', '164705', '164808', '164809', '164810', '164811', '164814', '164815', '164902', '164905', '165309', '165310', '165311', '165312', '165313', '165508', '165509', '165510', '165511', '165512', '165513', '165515', '165516', '165519', '165520', '165521', '165522', '165705', '165707', '165806', '165809', '166001', '166002', '166003', '166004', '166005', '166006', '166007', '166008', '166009', '166010', '166011', '166301', '166401', '166802', '166902', '166904', '167601', '167701', '167901', '169101', '184721', '184722', '184728', '300001', '300002', '300003', '300004', '300005', '300006', '300007', '300008', '300009', '300010', '300011', '300012', '300013', '300014', '300015', '300016', '300017', '300018', '300019', '300020', '300021', '300022', '300023', '300024', '300025', '300026', '300027', '300028', '300029', '300030', '300031', '300032', '300033', '300034', '300035', '300036', '300037', '300038', '300039', '300040', '300041', '300042', '300043', '300044', '300045', '300046', '300047', '300048', '300049', '300050', '300051', '300052', '300053', '300054', '300055', '300056', '300057', '300058', '300059', '300061', '300062', '300063', '300064', '300065', '300066', '300067', '300068', '300069', '300070', '300071', '300072', '300073', '300074', '300075', '300076', '300077', '300078', '300079', '300080', '300081', '300082', '300083', '300084', '300085', '300086', '300087', '300088', '300089', '300090', '300091', '300092', '300093', '300094', '300095', '300096', '300097', '300098', '300099', '300100', '300101', '300102', '300103', '300104', '300105', '300106', '300107', '300108', '300109', '300110', '300111', '300112', '300113', '300114', '300115', '300116', '300117', '300118', '300119', '300120', '300121', '300122', '300123', '300124', '300125', '300126', '300127', '300128', '300129', '300130', '300131', '300132', '300133', '300134', '300135', '300136', '300137', '300138', '300139', '300140', '300141', '300142', '300143', '300144', '300145', '300146', '300147', '300148', '300149', '300150', '300151', '300152', '300153', '300154', '300155', '300156', '300157', '300158', '300159', '300160', '300161', '300162', '300163', '300164', '300165', '300166', '300167', '300168', '300169', '300170', '300171', '300172', '300173', '300174', '300175', '300176', '300177', '300178', '300179', '300180', '300181', '300182', '300183', '300184', '300185', '300186', '300187', '300188', '300189', '300190', '300191', '300192', '300193', '300194', '300195', '300196', '300197', '300198', '300199', '300200', '300201', '300202', '300203', '300204', '300205', '300206', '300207', '300208', '300209', '300210', '300211', '300212', '300213', '300214', '300215', '300216', '300217', '300218', '300219', '300220', '300221', '300222', '300223', '300224', '300225', '300226', '300227', '300228', '300229', '300230', '300231', '300232', '300233', '300234', '300235', '300236', '300237', '300238', '300239', '300240', '300241', '300242', '300243', '300244', '300245', '300246', '300247', '300248', '300249', '300250', '300251', '300252', '300253', '300254', '300255', '300256', '300257', '300258', '300259', '300260', '300261', '300262', '300263', '300264', '300265', '300266', '300267', '300268', '300269', '300270', '300271', '300272', '300273', '300274', '300275', '300276', '300277', '300278', '300279', '300280', '300281', '300282', '300283', '300284', '300285', '300286', '300287', '300288', '300289', '300290', '300291', '300292', '300293', '300294', '300295', '300296', '300297', '300298', '300299', '300300', '300301', '300302', '300303', '300304', '300305', '300306', '300307', '300308', '300309', '300310', '300311', '300312', '300313', '300314', '300315', '300316', '300317', '300318', '300319', '300320', '300321', '300322', '300323', '300324', '300325', '300326', '300327', '300328', '300329', '300330', '300331', '300332', '300333', '300334', '300335', '300336', '300337', '300338', '300339', '300340', '300341', '300342', '300343', '300344', '300345', '300346', '300347', '300348', '300349', '300350', '300351', '300352', '300353', '300354', '300355', '300356', '300357', '300358', '300359', '300360', '300362', '300363', '300364', '300365', '300366', '300367', '300368', '300369', '300370', '300371', '300372', '300373', '300374', '300375', '300376', '300377', '300378', '300379', '300380', '300381', '300382', '300383', '300384', '300385', '300386', '300387', '300388', '300389', '300390', '300391', '300392', '300393', '300394', '300395', '300396', '300397', '300398', '300399', '300400', '300401', '300402', '300403', '300404', '300405', '300406', '300407', '300408', '300409', '300410', '300411', '300412', '300413', '300415', '300416', '300417', '300418', '300419', '300420', '300421', '300422', '300423', '300424', '300425', '300426', '300427', '300428', '300429', '300430', '300431', '300432', '300433', '300434', '300435', '300436', '300437', '300438', '300439', '300440', '300441', '300442', '300443', '300444', '300445', '300446', '300447', '300448', '300449']
'''Cached SHE stocks' codes'''